datasource database {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model Guild {
    id String @id @unique

    adminRoles String[]

    Subscription Subscription[]
}

model HolodexChannel {
    id          String  @id @unique
    name        String
    englishName String?
    image       String?

    videos         Video[]
    subscriptions  Subscription[]
    communityPosts CommunityPost[]
}

model Video {
    id String @id

    channelId String
    channel   HolodexChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
}

model Subscription {
    id String @id @default(uuid())

    // Stream notifs
    roleId                 String?
    discordChannelId       String?
    memberRoleId           String?
    memberDiscordChannelId String?

    // Community post notifs
    communityPostRoleId    String?
    communityPostChannelId String?

    channelId String
    channel   HolodexChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)

    guildId String
    guild   Guild  @relation(fields: [guildId], references: [id], onDelete: Cascade)

    @@unique([channelId, guildId])
}

model CommunityPost {
    id String @id @default(uuid())

    channelId String
    channel   HolodexChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
}
